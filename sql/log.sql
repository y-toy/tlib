/*　システムログ */
CREATE TABLE IF NOT EXISTS SYSTEM_LOG (
	LOG_ID INT AUTO_INCREMENT PRIMARY KEY,
	USER_ID INT comment 'ログ記録時のユーザID 0はユーザ無しでシステム地震が実行した処理のログ',
	LOG_TYPE INT NOT NULL comment 'ログの種類 1:INFO 2:WARNING 3:ERROR',
	LOG_MESSAGE TEXT comment 'ログメッセージ 改行は\n',
	INSERT_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- パーティション
ALTER TABLE SYSTEM_LOG PARTITION BY RANGE (YEAR(INSERT_TIME)) (
	PARTITION y2024 VALUES LESS THAN (2024),
	PARTITION y2025 VALUES LESS THAN (2025),
	PARTITION y2026 VALUES LESS THAN (2026),
	PARTITION y2027 VALUES LESS THAN (2027),
	PARTITION y2028 VALUES LESS THAN (2028),
	PARTITION y2029 VALUES LESS THAN (2029),
	PARTITION y2030 VALUES LESS THAN (2030),
	PARTITION y2031 VALUES LESS THAN (2031),
	PARTITION y2032 VALUES LESS THAN (2032),
	PARTITION y2033 VALUES LESS THAN (2033),
	PARTITION y2034 VALUES LESS THAN (2034),
	PARTITION y2035 VALUES LESS THAN (2035),
	PARTITION y2036 VALUES LESS THAN (2036),
	PARTITION y2037 VALUES LESS THAN (2037),
	PARTITION y2038 VALUES LESS THAN (2038),
	PARTITION y2039 VALUES LESS THAN (2039),
	PARTITION y2040 VALUES LESS THAN (2040),
	PARTITION y2041 VALUES LESS THAN (2041),
	PARTITION y2042 VALUES LESS THAN (2042),
);

/* アクティビティログ */
CREATE TABLE ACTIVITY_TYPE (
	ACTIVITY_TYPE_ID INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT 'アクティビティタイプの識別子',
	TYPE_NAME VARCHAR(50) NOT NULL COMMENT 'アクティビティタイプの名前'
) COMMENT='アクティビティタイプを管理するテーブル';

CREATE TABLE USER_ACTIVITY (
    ID INT PRIMARY KEY AUTO_INCREMENT COMMENT '一意の識別子',
    USER_ID INT UNSIGNED NOT NULL COMMENT 'ユーザの識別子',
    GROUP_ID INT UNSIGNED DEFAULT 0 COMMENT 'グループの識別子 0はグループ無し',
    ACTIVITY_TYPE_ID INT UNSIGNED NOT NULL COMMENT 'アクティビティタイプの識別子 ACTIVITY_TYPE::ACTIVITY_TYPE_ID',
    ACTIVITY_DETAIL TEXT COMMENT 'アクティビティの詳細 改行は\n',
    INSERT_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'アクティビティの日時',
    FOREIGN KEY (ACTIVITY_TYPE_ID) REFERENCES ACTIVITY_TYPE(ACTIVITY_TYPE_ID),
    INDEX idx_user_id (USER_ID),
    INDEX idx_group_id (GROUP_ID)
) COMMENT='ユーザのアクティビティを記録するテーブル';

-- パーティション
ALTER TABLE USER_ACTIVITY PARTITION BY RANGE (UNIX_TIMESTAMP(INSERT_TIME)) (
	PARTITION y202501 VALUES LESS THAN (UNIX_TIMESTAMP('2025-01-01 00:00:00')),
	PARTITION y202502 VALUES LESS THAN (UNIX_TIMESTAMP('2025-02-01 00:00:00')),
	PARTITION y202503 VALUES LESS THAN (UNIX_TIMESTAMP('2025-03-01 00:00:00')),
	PARTITION y202504 VALUES LESS THAN (UNIX_TIMESTAMP('2025-04-01 00:00:00')),
	PARTITION y202505 VALUES LESS THAN (UNIX_TIMESTAMP('2025-05-01 00:00:00')),
	PARTITION y202506 VALUES LESS THAN (UNIX_TIMESTAMP('2025-06-01 00:00:00')),
	PARTITION y202507 VALUES LESS THAN (UNIX_TIMESTAMP('2025-07-01 00:00:00')),
	PARTITION y202508 VALUES LESS THAN (UNIX_TIMESTAMP('2025-08-01 00:00:00')),
	PARTITION y202509 VALUES LESS THAN (UNIX_TIMESTAMP('2025-09-01 00:00:00')),
	PARTITION y202510 VALUES LESS THAN (UNIX_TIMESTAMP('2025-10-01 00:00:00')),
	PARTITION y202511 VALUES LESS THAN (UNIX_TIMESTAMP('2025-11-01 00:00:00')),
	PARTITION y202512 VALUES LESS THAN (UNIX_TIMESTAMP('2025-12-01 00:00:00')),
	PARTITION y202601 VALUES LESS THAN (UNIX_TIMESTAMP('2026-01-01 00:00:00')),
	PARTITION y202602 VALUES LESS THAN (UNIX_TIMESTAMP('2026-02-01 00:00:00')),
	PARTITION y202603 VALUES LESS THAN (UNIX_TIMESTAMP('2026-03-01 00:00:00')),
	PARTITION y202604 VALUES LESS THAN (UNIX_TIMESTAMP('2026-04-01 00:00:00')),
	PARTITION y202605 VALUES LESS THAN (UNIX_TIMESTAMP('2026-05-01 00:00:00')),
	PARTITION y202606 VALUES LESS THAN (UNIX_TIMESTAMP('2026-06-01 00:00:00')),
	PARTITION y202607 VALUES LESS THAN (UNIX_TIMESTAMP('2026-07-01 00:00:00')),
	PARTITION y202608 VALUES LESS THAN (UNIX_TIMESTAMP('2026-08-01 00:00:00')),
	PARTITION y202609 VALUES LESS THAN (UNIX_TIMESTAMP('2026-09-01 00:00:00')),
	PARTITION y202610 VALUES LESS THAN (UNIX_TIMESTAMP('2026-10-01 00:00:00')),
	PARTITION y202611 VALUES LESS THAN (UNIX_TIMESTAMP('2026-11-01 00:00:00')),
	PARTITION y202612 VALUES LESS THAN (UNIX_TIMESTAMP('2026-12-01 00:00:00')),
	PARTITION y202701 VALUES LESS THAN (UNIX_TIMESTAMP('2027-01-01 00:00:00')),
	PARTITION y202702 VALUES LESS THAN (UNIX_TIMESTAMP('2027-02-01 00:00:00')),
	PARTITION y202703 VALUES LESS THAN (UNIX_TIMESTAMP('2027-03-01 00:00:00')),
	PARTITION y202704 VALUES LESS THAN (UNIX_TIMESTAMP('2027-04-01 00:00:00')),
	PARTITION y202705 VALUES LESS THAN (UNIX_TIMESTAMP('2027-05-01 00:00:00')),
	PARTITION y202706 VALUES LESS THAN (UNIX_TIMESTAMP('2027-06-01 00:00:00')),
	PARTITION y202707 VALUES LESS THAN (UNIX_TIMESTAMP('2027-07-01 00:00:00')),
	PARTITION y202708 VALUES LESS THAN (UNIX_TIMESTAMP('2027-08-01 00:00:00')),
	PARTITION y202709 VALUES LESS THAN (UNIX_TIMESTAMP('2027-09-01 00:00:00')),
	PARTITION y202710 VALUES LESS THAN (UNIX_TIMESTAMP('2027-10-01 00:00:00')),
	PARTITION y202711 VALUES LESS THAN (UNIX_TIMESTAMP('2027-11-01 00:00:00')),
	PARTITION y202712 VALUES LESS THAN (UNIX_TIMESTAMP('2027-12-01 00:00:00')),
	PARTITION y202801 VALUES LESS THAN (UNIX_TIMESTAMP('2028-01-01 00:00:00')),
	PARTITION y202802 VALUES LESS THAN (UNIX_TIMESTAMP('2028-02-01 00:00:00')),
	PARTITION y202803 VALUES LESS THAN (UNIX_TIMESTAMP('2028-03-01 00:00:00')),
	PARTITION y202804 VALUES LESS THAN (UNIX_TIMESTAMP('2028-04-01 00:00:00')),
	PARTITION y202805 VALUES LESS THAN (UNIX_TIMESTAMP('2028-05-01 00:00:00')),
	PARTITION y202806 VALUES LESS THAN (UNIX_TIMESTAMP('2028-06-01 00:00:00')),
	PARTITION y202807 VALUES LESS THAN (UNIX_TIMESTAMP('2028-07-01 00:00:00')),
	PARTITION y202808 VALUES LESS THAN (UNIX_TIMESTAMP('2028-08-01 00:00:00')),
	PARTITION y202809 VALUES LESS THAN (UNIX_TIMESTAMP('2028-09-01 00:00:00')),
	PARTITION y202810 VALUES LESS THAN (UNIX_TIMESTAMP('2028-10-01 00:00:00')),
	PARTITION y202811 VALUES LESS THAN (UNIX_TIMESTAMP('2028-11-01 00:00:00')),
	PARTITION y202812 VALUES LESS THAN (UNIX_TIMESTAMP('2028-12-01 00:00:00')),
);

